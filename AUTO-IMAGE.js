async()=>{const C={COOLDOWN_DEFAULT:31000,TRANSPARENCY_THRESHOLD:100,WHITE_THRESHOLD:250,LOG_INTERVAL:10,THEME:{primary:"#10141c",secondary:"#182230",accent:"#293446",text:"#f5f7fa",highlight:"#5dd6ff",success:"#35d07f",error:"#ff4d61",warning:"#ffb347"}},T={pt:{title:"WPlace Auto-Image",initBot:"Iniciar Auto-BOT",uploadImage:"Upload da Imagem",resizeImage:"Redimensionar",selectPosition:"Selecionar PosiÃ§Ã£o",startPainting:"Iniciar Pintura",stopPainting:"Parar Pintura",checkingColors:"ðŸ” Verificando cores disponÃ­veis...",noColorsFound:"âŒ Abra a paleta de cores no site e tente novamente!",colorsFound:"âœ… {count} cores disponÃ­veis encontradas",loadingImage:"ðŸ–¼ï¸ Carregando imagem...",imageLoaded:"âœ… Imagem carregada com {count} pixels vÃ¡lidos",imageError:"âŒ Erro ao carregar imagem",selectPositionAlert:"Pinte o primeiro pixel onde deseja que a arte comece!",waitingPosition:"ðŸ‘† Aguardando pixel de referÃªncia...",positionSet:"âœ… PosiÃ§Ã£o definida!",positionTimeout:"âŒ Tempo esgotado para selecionar posiÃ§Ã£o",startPaintingMsg:"ðŸŽ¨ Iniciando pintura...",paintingProgress:"ðŸ§± Progresso: {painted}/{total} pixels...",noCharges:"âŒ› Sem cargas. Aguardando {time}...",paintingStopped:"â¹ï¸ Pintura interrompida",paintingComplete:"âœ… Pintura concluÃ­da! {count} pixels pintados.",paintingError:"âŒ Erro durante a pintura",missingRequirements:"âŒ Carregue uma imagem e selecione uma posiÃ§Ã£o primeiro",progress:"Progresso",pixels:"Pixels",charges:"Cargas",estimatedTime:"Tempo estimado",initMessage:"Clique em 'Iniciar Auto-BOT' para comeÃ§ar",waitingInit:"Aguardando inicializaÃ§Ã£o...",resizeSuccess:"âœ… Redimensionada para {width}x{height}",paintingPaused:"â¸ï¸ Pausado em X: {x}, Y: {y}",minimize:"Minimizar",width:"Largura",height:"Altura",keepAspect:"Manter proporÃ§Ã£o",apply:"Aplicar",cancel:"Cancelar"},en:{title:"WPlace Auto-Image",initBot:"Start Auto-BOT",uploadImage:"Upload Image",resizeImage:"Resize",selectPosition:"Select Position",startPainting:"Start Painting",stopPainting:"Stop Painting",checkingColors:"ðŸ” Checking available colors...",noColorsFound:"âŒ Open the palette and try again!",colorsFound:"âœ… {count} available colors found",loadingImage:"ðŸ–¼ï¸ Loading image...",imageLoaded:"âœ… Image loaded with {count} valid pixels",imageError:"âŒ Error loading image",selectPositionAlert:"Paint the first pixel where you want the art to start!",waitingPosition:"ðŸ‘† Waiting for reference pixel...",positionSet:"âœ… Position set!",positionTimeout:"âŒ Position selection timeout",startPaintingMsg:"ðŸŽ¨ Starting painting...",paintingProgress:"ðŸ§± Progress: {painted}/{total} pixels...",noCharges:"âŒ› No charges. Waiting {time}...",paintingStopped:"â¹ï¸ Painting stopped",paintingComplete:"âœ… Painting complete! {count} pixels painted.",paintingError:"âŒ Error during painting",missingRequirements:"âŒ Load an image and select a position first",progress:"Progress",pixels:"Pixels",charges:"Charges",estimatedTime:"Estimated time",initMessage:"Click 'Start Auto-BOT' to begin",waitingInit:"Waiting for initialization...",resizeSuccess:"âœ… Image resized to {width}x{height}",paintingPaused:"â¸ï¸ Paused at X: {x}, Y: {y}",minimize:"Minimize",width:"Width",height:"Height",keepAspect:"Keep aspect",apply:"Apply",cancel:"Cancel"}},S={running:!1,imageLoaded:!1,processing:!1,totalPixels:0,paintedPixels:0,availableColors:[],currentCharges:0,cooldown:C.COOLDOWN_DEFAULT,imageData:null,stopFlag:!1,colorsChecked:!1,startPosition:null,selectingPosition:!1,region:null,minimized:!1,lastPosition:{x:0,y:0},estimatedTime:0,language:"en"};function L(){const e=navigator.language.split("-")[0];T[e]&&(S.language=e)}const U={sleep:e=>new Promise(t=>setTimeout(t,e)),colorDistance:(e,t)=>Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2)),createImageUploader:()=>new Promise(e=>{const t=document.createElement("input");t.type="file",t.accept="image/png,image/jpeg",t.onchange=()=>{const i=new FileReader;i.onload=()=>e(i.result),i.readAsDataURL(t.files[0])},t.click()}),extractAvailableColors:()=>Array.from(document.querySelectorAll('[id^="color-"]')).filter(e=>!e.querySelector("svg")).filter(e=>{const t=parseInt(e.id.replace("color-",""));return t!==0&&t!==5}).map(e=>{const t=parseInt(e.id.replace("color-","")),i=e.style.backgroundColor.match(/\d+/g),n=i?i.map(Number):[0,0,0];return{id:t,rgb:n}}),formatTime:e=>{const t=Math.floor(e/1e3%60),i=Math.floor(e/6e4%60),n=Math.floor(e/36e5%24),o=Math.floor(e/864e5);let r="";return o>0&&(r+=`${o}d `),(n>0||o>0)&&(r+=`${n}h `),(i>0||n>0||o>0)&&(r+=`${i}m `),r+=`${t}s`,r},showAlert:(e,t="info")=>{const i=document.createElement("div");i.style.position="fixed",i.style.top="16px",i.style.left="50%",i.style.transform="translateX(-50%)",i.style.padding="12px 18px",i.style.background=C.THEME.secondary,i.style.border=`1px solid ${C.THEME.highlight}`,i.style.color=C.THEME.text,i.style.borderRadius="10px",i.style.font='500 14px "Segoe UI",sans-serif',i.style.zIndex="10000",i.style.display="flex",i.style.alignItems="center",i.style.gap="10px",i.style.backdropFilter="blur(6px)",i.style.boxShadow="0 4px 18px -2px rgba(0,0,0,.55)",i.innerHTML=`<span style="filter:drop-shadow(0 0 4px rgba(255,255,255,0.15))">${e}</span>`,document.body.appendChild(i),setTimeout(()=>{i.style.transition="all .4s",i.style.opacity="0",i.style.transform+=" translateY(-8px)",setTimeout(()=>i.remove(),450)},2600)},calculateEstimatedTime:(e,t,i)=>{const n=t>0?t:0,o=Math.ceil((e-n)/Math.max(t,1));return o*i+(e-1)*100},isWhitePixel:(e,t,i)=>e>=C.WHITE_THRESHOLD&&t>=C.WHITE_THRESHOLD&&i>=C.WHITE_THRESHOLD,t:(e,t={})=>{let i=T[S.language]?.[e]||T.en[e]||e;for(const[n,o]of Object.entries(t))i=i.replace(`{${n}}`,o);return i}},W={async paintPixelInRegion(e,t,i,n,o){try{const r=await fetch(`https://backend.wplace.live/s0/pixel/${e}/${t}`,{method:"POST",headers:{"Content-Type":"text/plain;charset=UTF-8"},credentials:"include",body:JSON.stringify({coords:[i,n],colors:[o]})});return(await r.json())?.painted===1}catch{return!1}},async getCharges(){try{const e=await fetch("https://backend.wplace.live/me",{credentials:"include"}),t=await e.json();return{charges:t.charges?.count||0,cooldown:t.charges?.cooldownMs||C.COOLDOWN_DEFAULT}}catch{return{charges:0,cooldown:C.COOLDOWN_DEFAULT}}}};class I{constructor(e){this.imageSrc=e,this.img=new Image,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.previewCanvas=document.createElement("canvas"),this.previewCtx=this.previewCanvas.getContext("2d")}async load(){return new Promise((e,t)=>{this.img.onload=()=>{this.canvas.width=this.img.width,this.canvas.height=this.img.height,this.ctx.drawImage(this.img,0,0),e()},this.img.onerror=t,this.img.src=this.imageSrc})}getPixelData(){return this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height).data}getDimensions(){return{width:this.canvas.width,height:this.canvas.height}}resize(e,t){const i=document.createElement("canvas");i.width=e,i.height=t;const n=i.getContext("2d");return n.drawImage(this.img,0,0,e,t),this.canvas.width=e,this.canvas.height=t,this.ctx.drawImage(i,0,0),this.getPixelData()}generatePreview(e,t){return this.previewCanvas.width=e,this.previewCanvas.height=t,this.previewCtx.imageSmoothingEnabled=!1,this.previewCtx.drawImage(this.img,0,0,e,t),this.previewCanvas.toDataURL()}}function F(e,t){return t.reduce((i,n)=>{const o=U.colorDistance(e,n.rgb);return o<i.distance?{color:n,distance:o}:i},{color:t[0],distance:U.colorDistance(e,t[0].rgb)}).color.id}async function G(){L();const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css",document.head.appendChild(e);const t=document.createElement("style");t.textContent=`@keyframes wplaceSlide{from{transform:translateY(12px);opacity:0}to{transform:translateY(0);opacity:1}}@keyframes glowPulse{0%{box-shadow:0 0 0 0 rgba(93,214,255,.45)}70%{box-shadow:0 0 0 10px rgba(93,214,255,0)}100%{box-shadow:0 0 0 0 rgba(93,214,255,0)}}#wplace-image-bot-container{position:fixed;top:24px;right:24px;width:340px;background:linear-gradient(155deg,rgba(24,34,48,.92),rgba(16,20,28,.92));-webkit-backdrop-filter:blur(14px) saturate(130%);backdrop-filter:blur(14px) saturate(130%);border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:0;box-shadow:0 18px 48px -12px rgba(0,0,0,.55),0 0 0 1px rgba(255,255,255,.04) inset;z-index:9998;font-family:"Segoe UI",Roboto,Oxygen,sans-serif;color:${C.THEME.text};animation:wplaceSlide .45s cubic-bezier(.3,.7,.4,1);overflow:hidden}.wplace-header{position:relative;padding:14px 18px 12px;display:flex;align-items:center;justify-content:space-between;background:radial-gradient(at 25% 0%,rgba(93,214,255,.15),rgba(93,214,255,0) 70%);user-select:none}.wplace-header-title{display:flex;align-items:center;gap:10px;font-weight:600;letter-spacing:.5px;font-size:15px}.wplace-header-title i{color:${C.THEME.highlight};filter:drop-shadow(0 0 4px rgba(93,214,255,.35))}.wplace-header-controls{display:flex;gap:4px}.wplace-header-btn{width:34px;height:34px;display:grid;place-items:center;border:1px solid rgba(255,255,255,.08);background:linear-gradient(145deg,rgba(255,255,255,.05),rgba(255,255,255,.02));border-radius:10px;cursor:pointer;color:${C.THEME.text};font-size:13px;transition:.25s}.wplace-header-btn:hover{border-color:rgba(93,214,255,.6);color:${C.THEME.highlight};box-shadow:0 0 0 1px rgba(93,214,255,.5),0 4px 12px -4px rgba(93,214,255,.4)}.wplace-content{padding:4px 18px 18px;display:flex;flex-direction:column;gap:16px}.wplace-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:10px}.wplace-btn{position:relative;border:1px solid rgba(255,255,255,.08);background:linear-gradient(145deg,rgba(255,255,255,.07),rgba(255,255,255,.02));color:${C.THEME.text};padding:10px;font-size:12.5px;font-weight:600;letter-spacing:.3px;border-radius:11px;display:flex;align-items:center;justify-content:flex-start;gap:8px;cursor:pointer;transition:.28s;min-height:40px;overflow:hidden}.wplace-btn:before{content:"";position:absolute;inset:0;background:linear-gradient(160deg,rgba(93,214,255,.18),rgba(93,214,255,0) 60%);opacity:0;transition:.35s}.wplace-btn:hover:before{opacity:1}.wplace-btn:hover{border-color:rgba(93,214,255,.5);box-shadow:0 4px 18px -6px rgba(93,214,255,.55);transform:translateY(-2px)}.wplace-btn:disabled{opacity:.35;cursor:not-allowed;filter:grayscale(.5);transform:none}.wplace-btn-primary{color:${C.THEME.highlight}}.wplace-btn-select{color:#ffe08a}.wplace-btn-start{color:${C.THEME.success}}.wplace-btn-stop{color:${C.THEME.error}}.panel{display:flex;flex-direction:column;gap:12px;padding:14px 16px 16px;border:1px solid rgba(255,255,255,.07);border-radius:16px;background:linear-gradient(160deg,rgba(255,255,255,.05),rgba(255,255,255,.015));position:relative}.panel:before{content:"";position:absolute;inset:0;border-radius:16px;padding:1px;background:linear-gradient(140deg,rgba(93,214,255,.4),rgba(93,214,255,0) 45%);-webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);-webkit-mask-composite:xor;mask-composite:exclude;pointer-events:none;opacity:.35}.panel-title{font-size:11px;text-transform:uppercase;letter-spacing:1.4px;font-weight:700;color:${C.THEME.highlight};opacity:.85;display:flex;align-items:center;gap:6px}.stats-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:10px}.stat-card{position:relative;border:1px solid rgba(255,255,255,.08);background:linear-gradient(150deg,rgba(255,255,255,.07),rgba(255,255,255,.015));border-radius:12px;padding:10px 12px 9px;display:flex;flex-direction:column;gap:6px;font-size:12px;line-height:1.2;min-height:62px;overflow:hidden}.stat-card:before{content:"";position:absolute;inset:0;background:radial-gradient(circle at 80% 20%,rgba(93,214,255,.3),rgba(93,214,255,0) 70%);opacity:.18;pointer-events:none}.stat-label{font-size:10px;letter-spacing:1.2px;text-transform:uppercase;opacity:.6;font-weight:600}.stat-value{font-size:14px;font-weight:600;letter-spacing:.3px;display:flex;align-items:center;gap:6px}.progress-wrapper{display:flex;flex-direction:column;gap:8px}.progress-bar-outer{position:relative;width:100%;height:12px;background:linear-gradient(90deg,rgba(255,255,255,.08),rgba(255,255,255,0.03));border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,.08)}.wplace-progress-bar{height:100%;background:linear-gradient(90deg,${C.THEME.highlight},#7effc8);width:0%;transition:width .45s cubic-bezier(.25,.7,.4,1);box-shadow:0 0 0 1px rgba(93,214,255,.4),0 4px 18px -4px rgba(93,214,255,.7)}.status-zone{border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px 16px;font-size:13px;line-height:1.3;position:relative;background:linear-gradient(140deg,rgba(255,255,255,.07),rgba(255,255,255,.02));display:flex;gap:10px;align-items:flex-start}.status-zone:before{content:"";position:absolute;inset:0;background:radial-gradient(circle at 12% 20%,rgba(93,214,255,.32),rgba(93,214,255,0) 75%);opacity:.25;pointer-events:none}.status-icon{width:30px;height:30px;display:grid;place-items:center;border-radius:10px;background:linear-gradient(145deg,rgba(93,214,255,.28),rgba(93,214,255,0.08));color:${C.THEME.highlight};font-size:14px;box-shadow:0 0 0 1px rgba(93,214,255,.4)}.wplace-status{flex:1;font-weight:500;letter-spacing:.3px}.status-success{color:${C.THEME.success}}.status-error{color:${C.THEME.error}}.status-warning{color:${C.THEME.warning}}.wplace-minimized .wplace-content{display:none}.resize-container{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(160deg,#182230,#10141c);padding:26px 28px 28px;border-radius:22px;z-index:10000;width:clamp(300px,520px,90%);border:1px solid rgba(255,255,255,.08);box-shadow:0 18px 42px -10px rgba(0,0,0,.7),0 0 0 1px rgba(255,255,255,.05) inset;animation:wplaceSlide .4s ease}.resize-container h3{margin:0 0 6px;font-size:16px;letter-spacing:.5px;font-weight:600;display:flex;align-items:center;gap:8px;color:${C.THEME.highlight}}.resize-controls{display:flex;flex-direction:column;gap:16px;margin-top:10px}.resize-controls label{display:flex;flex-direction:column;gap:6px;font-size:12px;font-weight:600;letter-spacing:.4px;opacity:.9}.resize-slider{width:100%;appearance:none;height:8px;border-radius:100px;background:linear-gradient(90deg,#203041,#16202c);border:1px solid rgba(255,255,255,.1);outline:none}.resize-slider::-webkit-slider-thumb{appearance:none;width:20px;height:20px;background:linear-gradient(145deg,${C.THEME.highlight},#9dffe0);border-radius:50%;cursor:pointer;box-shadow:0 0 0 4px rgba(93,214,255,.35),0 4px 14px -4px rgba(93,214,255,.7);border:none}#resizePreview{max-width:100%;max-height:260px;border:1px solid rgba(255,255,255,.1);border-radius:14px;background:#0c1015;object-fit:contain;box-shadow:0 4px 18px -6px rgba(0,0,0,.7)}.resize-buttons{display:flex;justify-content:flex-end;gap:12px}.resize-overlay{position:fixed;inset:0;background:rgba(10,14,20,.85);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);z-index:9999;display:none}`,document.head.appendChild(t);const i=document.createElement("div");i.id="wplace-image-bot-container",i.innerHTML=`<div class="wplace-header"><div class="wplace-header-title"><i class="fas fa-shapes"></i><span>${U.t("title")}</span></div><div class="wplace-header-controls"><button id="minimizeBtn" class="wplace-header-btn" title="${U.t("minimize")}"><i class="fas fa-minus"></i></button></div></div><div class="wplace-content"><div class="panel"><div class="panel-title"><i class="fas fa-cogs"></i> SETUP</div><div class="wplace-grid"><button id="initBotBtn" class="wplace-btn wplace-btn-primary"><i class="fas fa-robot"></i><span>${U.t("initBot")}</span></button><button id="uploadBtn" class="wplace-btn" disabled><i class="fas fa-upload"></i><span>${U.t("uploadImage")}</span></button><button id="resizeBtn" class="wplace-btn" disabled><i class="fas fa-expand"></i><span>${U.t("resizeImage")}</span></button><button id="selectPosBtn" class="wplace-btn wplace-btn-select" disabled><i class="fas fa-crosshairs"></i><span>${U.t("selectPosition")}</span></button><button id="startBtn" class="wplace-btn wplace-btn-start" disabled><i class="fas fa-play"></i><span>${U.t("startPainting")}</span></button><button id="stopBtn" class="wplace-btn wplace-btn-stop" disabled><i class="fas fa-stop"></i><span>${U.t("stopPainting")}</span></button></div></div><div class="panel"><div class="panel-title"><i class="fas fa-chart-line"></i> TRACKING</div><div class="progress-wrapper"><div class="progress-bar-outer"><div id="progressBar" class="wplace-progress-bar"></div></div></div><div id="statsArea" class="stats-grid"><div class="stat-card"><div class="stat-label">${U.t("progress")}</div><div class="stat-value"><i class="fas fa-info-circle"></i> 0%</div></div><div class="stat-card"><div class="stat-label">${U.t("pixels")}</div><div class="stat-value"><i class="fas fa-paint-brush"></i> 0/0</div></div><div class="stat-card"><div class="stat-label">${U.t("charges")}</div><div class="stat-value"><i class="fas fa-bolt"></i> 0</div></div><div class="stat-card"><div class="stat-label">${U.t("estimatedTime")}</div><div class="stat-value"><i class="fas fa-clock"></i> 0s</div></div></div></div><div class="status-zone"><div class="status-icon"><i class="fas fa-terminal"></i></div><div id="statusText" class="wplace-status status-default">${U.t("waitingInit")}</div></div></div>`;const n=document.createElement("div");n.className="resize-container",n.innerHTML=`<h3><i class="fas fa-expand"></i> ${U.t("resizeImage")}</h3><div class="resize-controls"><label>${U.t("width")}: <span id="widthValue">0</span>px<input type="range" id="widthSlider" class="resize-slider" min="10" max="500" value="100"></label><label>${U.t("height")}: <span id="heightValue">0</span>px<input type="range" id="heightSlider" class="resize-slider" min="10" max="500" value="100"></label><label style="flex-direction:row;align-items:center;gap:8px;font-size:12px;"><input type="checkbox" id="keepAspect" checked style="transform:scale(1.15);accent-color:${C.THEME.highlight}">${U.t("keepAspect")}</label><img id="resizePreview" src=""><div class="resize-buttons"><button id="confirmResize" class="wplace-btn wplace-btn-start" style="min-width:120px;justify-content:center;"><i class="fas fa-check"></i><span>${U.t("apply")}</span></button><button id="cancelResize" class="wplace-btn wplace-btn-stop" style="min-width:120px;justify-content:center;"><i class="fas fa-times"></i><span>${U.t("cancel")}</span></button></div></div>`;const o=document.createElement("div");o.className="resize-overlay",document.body.appendChild(i),document.body.appendChild(o),document.body.appendChild(n);const r=i.querySelector(".wplace-header");let a=0,l=0,d=0,p=0;function h(g){g.preventDefault(),d=g.clientX,p=g.clientY,document.onmouseup=m,document.onmousemove=y}function y(g){g.preventDefault(),a=d-g.clientX,l=p-g.clientY,d=g.clientX,p=g.clientY,i.style.top=i.offsetTop-l+"px",i.style.left=i.offsetLeft-a+"px"}function m(){document.onmouseup=null,document.onmousemove=null}r.onmousedown=e=>{e.target.closest(".wplace-header-btn")||h(e)};const c=i.querySelector("#initBotBtn"),f=i.querySelector("#uploadBtn"),v=i.querySelector("#resizeBtn"),b=i.querySelector("#selectPosBtn"),E=i.querySelector("#startBtn"),w=i.querySelector("#stopBtn"),B=i.querySelector("#minimizeBtn"),x=i.querySelector("#statusText"),k=i.querySelector("#progressBar"),M=i.querySelector("#statsArea"),H=n.querySelector("#widthSlider"),q=n.querySelector("#heightSlider"),R=n.querySelector("#widthValue"),A=n.querySelector("#heightValue"),O=n.querySelector("#keepAspect"),N=n.querySelector("#resizePreview"),_n=n.querySelector("#confirmResize"),D=n.querySelector("#cancelResize");B.addEventListener("click",()=>{S.minimized=!S.minimized,S.minimized?(i.classList.add("wplace-minimized"),B.innerHTML='<i class="fas fa-expand"></i>'):(i.classList.remove("wplace-minimized"),B.innerHTML='<i class="fas fa-minus"></i>')}),window.updateUI=(g,z="default",K={})=>{const Y=U.t(g,K);x.textContent=Y,x.className=`wplace-status status-${z}`;const j=x.parentElement.querySelector(".status-icon");j.className="status-icon","success"===z&&(j.style.background="linear-gradient(145deg,rgba(53,208,127,0.25),rgba(53,208,127,0.08))"),"error"===z&&(j.style.background="linear-gradient(145deg,rgba(255,77,97,0.25),rgba(255,77,97,0.08))"),"warning"===z&&(j.style.background="linear-gradient(145deg,rgba(255,179,71,0.25),rgba(255,179,71,0.08))")},window.updateStats=async()=>{if(!S.colorsChecked||!S.imageLoaded)return;const{charges:g,cooldown:z}=await W.getCharges();S.currentCharges=Math.floor(g),S.cooldown=z;const K=S.totalPixels>0?Math.round(S.paintedPixels/S.totalPixels*100):0,Y=S.totalPixels-S.paintedPixels;S.estimatedTime=U.calculateEstimatedTime(Y,S.currentCharges,S.cooldown),k.style.width=`${K}%`,M.innerHTML=`<div class="stat-card"><div class="stat-label">${U.t("progress")}</div><div class="stat-value"><i class="fas fa-chart-line"></i> ${K}%</div></div><div class="stat-card"><div class="stat-label">${U.t("pixels")}</div><div class="stat-value"><i class="fas fa-paint-brush"></i> ${S.paintedPixels}/${S.totalPixels}</div></div><div class="stat-card"><div class="stat-label">${U.t("charges")}</div><div class="stat-value"><i class="fas fa-bolt"></i> ${Math.floor(S.currentCharges)}</div></div>${S.imageLoaded?`<div class="stat-card"><div class="stat-label">${U.t("estimatedTime")}</div><div class="stat-value"><i class="fas fa-clock"></i> ${U.formatTime(S.estimatedTime)}</div></div>`:""}`};function P(g){const z=g.getDimensions(),K=z.width/z.height;H.value=z.width,q.value=z.height,R.textContent=z.width,A.textContent=z.height,N.src=g.img.src,o.style.display="block",n.style.display="block";const Y=()=>{const j=parseInt(H.value),Q=parseInt(q.value);R.textContent=j,A.textContent=Q,N.src=g.generatePreview(j,Q)};H.oninput=()=>{if(O.checked){const j=parseInt(H.value),Q=Math.round(j/K);q.value=Q}Y()},q.oninput=()=>{if(O.checked){const j=parseInt(q.value),Q=Math.round(j*K);H.value=Q}Y()},_n.onclick=()=>{const j=parseInt(H.value),Q=parseInt(q.value),J=g.resize(j,Q);let V=0;for(let Z=0;Z<Q;Z++)for(let $=0;$<j;$++){const tt=(Z*j+$)*4,Gt=J[tt],et=J[tt+1],it=J[tt+2],nt=J[tt+3];if(nt<C.TRANSPARENCY_THRESHOLD)continue;if(U.isWhitePixel(Gt,et,it))continue;V++}S.imageData.pixels=J,S.imageData.width=j,S.imageData.height=Q,S.imageData.totalPixels=V,S.totalPixels=V,S.paintedPixels=0,updateStats(),updateUI("resizeSuccess","success",{width:j,height:Q}),I0()},D.onclick=I0}function I0(){o.style.display="none",n.style.display="none"}c.addEventListener("click",async()=>{try{updateUI("checkingColors","default"),S.availableColors=U.extractAvailableColors();if(S.availableColors.length===0)return U.showAlert(U.t("noColorsFound"),"error"),updateUI("noColorsFound","error"),void 0;S.colorsChecked=!0,f.disabled=!1,b.disabled=!1,c.style.display="none",updateUI("colorsFound","success",{count:S.availableColors.length}),updateStats()}catch{updateUI("imageError","error")}}),f.addEventListener("click",async()=>{try{updateUI("loadingImage","default");const g=await U.createImageUploader(),z=new I(g);await z.load();const K=z.getDimensions(),Y=K.width,j=K.height,Q=z.getPixelData();let J=0;for(let V=0;V<j;V++)for(let Z=0;Z<Y;Z++){const $=(V*Y+Z)*4,tt=Q[$],Gt=Q[$+1],et=Q[$+2],it=Q[$+3];if(it<C.TRANSPARENCY_THRESHOLD)continue;if(U.isWhitePixel(tt,Gt,et))continue;J++}S.imageData={width:Y,height:j,pixels:Q,totalPixels:J,processor:z},S.totalPixels=J,S.paintedPixels=0,S.imageLoaded=!0,S.lastPosition={x:0,y:0},v.disabled=!1,S.startPosition&&(E.disabled=!1),updateStats(),updateUI("imageLoaded","success",{count:J})}catch{updateUI("imageError","error")}}),v.addEventListener("click",()=>{S.imageLoaded&&S.imageData.processor&&P(S.imageData.processor)}),b.addEventListener("click",async()=>{if(S.selectingPosition)return;S.selectingPosition=!0,S.startPosition=null,S.region=null,E.disabled=!0,U.showAlert(U.t("selectPositionAlert"),"info"),updateUI("waitingPosition","default");const g=window.fetch;window.fetch=async(z,K)=>{if(typeof z=="string"&&z.includes("https://backend.wplace.live/s0/pixel/")&&K?.method?.toUpperCase()==="POST")try{const Y=await g(z,K),j=Y.clone(),Q=await j.json();if(Q?.painted===1){const J=z.match(/\/pixel\/(\d+)\/(\d+)/);if(J&&J.length>=3&&(S.region={x:parseInt(J[1]),y:parseInt(J[2])}),K.body){const V=JSON.parse(K.body);V?.coords&&Array.isArray(V.coords)&&(S.startPosition={x:V.coords[0],y:V.coords[1]},S.lastPosition={x:0,y:0},S.imageLoaded&&(E.disabled=!1),window.fetch=g,S.selectingPosition=!1,updateUI("positionSet","success"))}}return Y}catch{return g(z,K)}return g(z,K)},setTimeout(()=>{S.selectingPosition&&(window.fetch=g,S.selectingPosition=!1,updateUI("positionTimeout","error"),U.showAlert(U.t("positionTimeout"),"error"))},12e4)}),E.addEventListener("click",async()=>{if(!S.imageLoaded||!S.startPosition||!S.region)return updateUI("missingRequirements","error"),void 0;S.running=!0,S.stopFlag=!1,E.disabled=!0,w.disabled=!1,f.disabled=!0,b.disabled=!0,v.disabled=!0,updateUI("startPaintingMsg","success");try{await T0()}catch{updateUI("paintingError","error")}finally{S.running=!1,w.disabled=!0,S.stopFlag?(E.disabled=!1):(E.disabled=!0,f.disabled=!1,b.disabled=!1,v.disabled=!1)}}),w.addEventListener("click",()=>{S.stopFlag=!0,S.running=!1,w.disabled=!0,updateUI("paintingStopped","warning")})}async function T0(){const{width:e,height:t,pixels:i}=S.imageData,{x:n,y:o}=S.startPosition,{x:r,y:a}=S.region;let l=S.lastPosition.y||0,d=S.lastPosition.x||0;outerLoop:for(let p=l;p<t;p++)for(let h=p===l?d:0;h<e;h++){if(S.stopFlag){S.lastPosition={x:h,y:p},updateUI("paintingPaused","warning",
{...},{x:h,y:p});break outerLoop}const y=(p*e+h)*4,m=i[y],c=i[y+1],f=i[y+2],v=i[y+3];if(v<C.TRANSPARENCY_THRESHOLD)continue;if(U.isWhitePixel(m,c,f))continue;const b=[m,c,f],E=F(b,S.availableColors);if(S.currentCharges<1){updateUI("noCharges","warning",{time:U.formatTime(S.cooldown)}),await U.sleep(S.cooldown);const w=await W.getCharges();S.currentCharges=w.charges,S.cooldown=w.cooldown}const B=n+h,x=o+p,k=await W.paintPixelInRegion(r,a,B,x,E);k&&(S.paintedPixels++,S.currentCharges--,S.estimatedTime=U.calculateEstimatedTime(S.totalPixels-S.paintedPixels,S.currentCharges,S.cooldown),S.paintedPixels%C.LOG_INTERVAL===0&&(updateStats(),updateUI("paintingProgress","default",{painted:S.paintedPixels,total:S.totalPixels})))}S.stopFlag?updateUI("paintingStopped","warning"):(updateUI("paintingComplete","success",{count:S.paintedPixels}),S.lastPosition={x:0,y:0}),updateStats()}G();})();